#!/bin/sh

# This script serves as a series of commands to run within Kali Linux to prepare
# my pent-testing workflow.

# Usage:

# sudo chmod +x setup.sh
# sudo ./setup.sh

# 1. Install python-nmap without having access to the pip install domain
tar xvzf python-nmap-0.7.1.tar.gz
cd python-nmap-0.7.1
python setup.py install
cd ..

# 2. Install nmap script for mapping service signatures to CVEs
git clone https://github.com/scipag/vulscan scipag_vulscan
ln -s `pwd`/scipag_vulscan /usr/share/nmap/scripts/vulscan

# 3. Install Jupyter to better navigate vulnerability data

# Note: Because of of limited domain access on
# Proving Grounds, we need to do an offline install.

# Offline install guide (on the user's local PC with network access):
# - Setup and activate a venv:
# > python -m venv .venv
# - Install desired packages
# > pip freeze -l > requirements.txt
# > mkdir wheelhouse
# > pip download -r requirements.txt -d wheelhouse

#cp requirements.txt wheelhouse/requirements.txt
#pip install -r wheelhouse/requirements.txt --no-index --find-links wheelhouse

# This approach ultimately failed/stalled for me with version-related errors.

# Advice from internet:
# the easiest way to offline pip install is to do a pip download [package]. that will grab the library and all subdependencies into the folder. then make an archive of the folder and do a local pip install on the target (pip install --no-index --find-links ./folder [package]).

# 3. Alternate Jupyter install approach: Docker

#sudo apt install -y docker.io
#sudo systemctl enable docker --now

# Offline install guide (on the user's local PC with network access):
# > docker pull jupyter/scipy-notebook:6b49f3337709
# - Save that image to a .tar file.
# > docker save --output jupyter.tar jupyter/scipy-notebook:6b49f3337709
# - Slice it to evade GitHub's file size limit (it's too big for Git LFS too)
# > split -b 100M jupyter.tar ls.

#cat ./jupyter_slices/ls.?? > ../jupyter.tar
#docker load --input jupyter.tar

# This solution fails because there isn't enough storage space in Proving Grounds to download the image.
